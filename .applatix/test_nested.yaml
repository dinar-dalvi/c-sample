
---
type: service_template
subtype: container
name: fake fixture
description: create a fake fixture that just sleeps and do nothing
container:
  resources:
    mem_mib: 256
    cpu_cores: 0.1
  image: get.applatix.io/applatix/axscm:v1
  command: "sleep 999999999; ping %%db%%"
inputs:
  parameters:
    db:

---
    type: service_template
    subtype: workflow
    name: checkout and build
    description: checkout and build
    outputs:
        artifacts:
            code:
                from: "%%service.checkout.code%%"
    steps:
        - checkout:
            template: axscm-checkout
        - build:
            template: axbuild2
            parameters:
                build_command: ls /src
                checked_out_code: "%%steps.checkout.code%%"

---
    type: service_template
    subtype: workflow
    name: build nested
    inputs:
        parameters:
            checked_out_code:
    steps:
        - build:
            template: axbuild2
            parameters:
                build_command: ls /src

---
    type: service_template
    subtype: workflow
    name: test nested
    description: This is a nested workflow. The first step checkouts code and
        does a build. It exposes the checkout's artifact as its own artiface.
        The second step uses the first step's checkout artifact to make ye
        another build.
    fixtures:
        - my fake fixture:
            template: fake fixture
            parameters:
                db: " localhost"
    steps:
        - checkout and build:
            template: checkout and build
        - yet another build:
            template: build nested
            parameters:
                build_command: ls /src
                checked_out_code: "%%steps.checkout and build.code%%"
